---
layout: post
tags: 操作系统
date: 2018-06-11
title: FAT32文件系统剖析
---



# FAT32文件系统剖析

## 1.FAT文件系统的逻辑盘空间划分

- 引导区（BOOT Sector）、文件分配区（FAT区）、数据区（DATA区）
- 引导区和文件分配表区又合成系统区

## 2.引导区

- 从第一扇区（sector）开始，使用三个扇区，保存逻辑盘的每扇区字节数，每簇对应的扇区数等等主要参数和引导记录。之后还留有若干保留扇区。FAT16文件系统的引导区只占用一个扇区，没有保留扇区。

## 3.文件分配区

- 共保存了两个相同的文件分配表，因为文件占用的存储空间（簇链）及空闲空间的管理都是通过FAT实现的，FAT很重要，保存两个以便第一个损坏时，还有第二个可用。文件系统对数据区的存储空间是按簇（cluster）进行划分和管理的，簇是空间分配和回收的基本单位，即，一个文件总是占用若干给整簇，文件所使用的最后一簇空间剩余的空间就不再使用，也就是浪费掉了。
- 从统计学上讲，平均每个文件浪费0.5簇的空间，簇越大，存储文件时的浪费就越多，利用率越低。因此，簇的大小决定了该盘数据区的利用率。FAT32系统簇号用32为二进制表示，大致从00000002H到FFFFFEFFH个可用簇号。FAT表按顺序依次记录了该盘各簇的使用情况，是一种位示图法。
- 每簇的使用情况用32位二进制填写，未被分配的簇相应位置写零；坏簇相应位置填入特定值；已分配的簇相应位置填入非零值，具体为：如果该簇是文件的最后一簇，填入的值为FFFFFF0FH，如果该簇不是文件的最后一簇，填入的值为该文件占用的下一个簇的簇号，这样，正好将文件占用的各簇构成一个簇链，保存在FAT表中。0000000H、00000001H两簇号不使用，其对应的两个DWORD位置(FAT表开头的8个字节)用来存放该盘介质类型编号。FAT表的大小就由该逻辑盘数据区共有多少簇所决定，取整数个扇区。

## 4.根目录（ROOT区）

- 不再是固定大小，固定区域，可看作是数据区的一部分。因为根目录已改为根目录文件，采用与子目录文件相同的管理方式，一般情况下从第二簇开始使用，大小视需要增加，因此根目录下的文件数目不再受最多512的限制。

## 5.目录区

- 目录区中的目录项变化较多，一个目录项仍占32字节，可以是文件目录项、子目录项、卷标项(仅跟目录有)、已删除目录项、长文件名目录项等。目录项中原来在DOS下保留未用的10个字节都有了新的定义，全部32字节的定义

  (1) 0-- 7字节 文件正名。 

  (2) 8--10字节 文件扩展名。 

  (3) 11字节 文件属性，按二进制位定义，最高两位保留未用，0至5位分别是只读位、隐藏位、系统位、卷标位、子目录位、归档位。 

  (4) 11--13字节 仅长文件名目录项用，用来存储其对应的短文件名目录项的文件名字节校验和等。 

  (5) 13--15字节 24位二进制的文件建立时间，其中的高5位为小时，次6位为分钟。 

  (6) 16--17字节 16位二进制的文件建立日期，其中的高7位为相对于1980年的年份值，次4位为月份，后5位为月内日期。 

  (7) 18--19字节 16位二进制的文件最新访问日期，定义同(6)。

  (8) 20--21字节 起始簇号的高16位。

  (9) 22--23字节 16位二进制的文件最新修改时间，其中的高5位为小时，次6位为分钟，后5位的二倍为秒数。 

  (10)24--25字节 16位二进制的文件最新修改日期，定义同(6)。

  (11)26--27字节 起始簇号的低16位。 

  (12)28--31字节 32位的文件字节长度。 

  